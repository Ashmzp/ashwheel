# ğŸš€ Complete Setup: Supabase + Ashwheel on Coolify (31.97.235.213)

## ğŸ“‹ Architecture Overview

```
VPS: 31.97.235.213 (Hostinger KVM4)
â”œâ”€â”€ Coolify Panel (Port 8000)
â”œâ”€â”€ Caddy Proxy (Ports 80, 443)
â”œâ”€â”€ Supabase (Self-hosted via Coolify)
â”‚   â””â”€â”€ URL: supabase.ashwheel.cloud
â””â”€â”€ Ashwheel App
    â””â”€â”€ URL: ashwheel.cloud
```

---

## ğŸ¯ Step 1: Deploy Supabase on Coolify

### 1.1 Login to Coolify
```
URL: http://31.97.235.213:8000
```

### 1.2 Create Supabase Service

1. Click **"+ New Resource"**
2. Select **"Service"**
3. Search for **"Supabase"**
4. Click **"Deploy"**

### 1.3 Configure Supabase

**Domain Settings:**
- **Domain:** `supabase.ashwheel.cloud`
- **SSL:** Enable (automatic via Caddy)

**Environment Variables (Auto-generated by Coolify):**
- `POSTGRES_PASSWORD` - Auto-generated
- `JWT_SECRET` - Auto-generated
- `ANON_KEY` - Auto-generated
- `SERVICE_ROLE_KEY` - Auto-generated

**Important:** Note down these values after deployment!

### 1.4 DNS Configuration

Add A record in your domain:
```
supabase.ashwheel.cloud  â†’  31.97.235.213
```

### 1.5 Deploy Supabase

Click **"Deploy"** and wait 5-10 minutes.

After deployment, you'll get:
- **Supabase Studio:** `https://supabase.ashwheel.cloud`
- **API URL:** `https://supabase.ashwheel.cloud`
- **Anon Key:** (from Coolify environment variables)

---

## ğŸ¯ Step 2: Import Database Schema

### 2.1 Access Supabase Studio
```
URL: https://supabase.ashwheel.cloud
Login with credentials from Coolify
```

### 2.2 Import Schema via SQL Editor

1. Go to **SQL Editor** in Supabase Studio
2. Copy content from `dump/schema.sql`
3. Run the SQL
4. Copy content from `dump/roles.sql`
5. Run the SQL
6. Copy content from `dump/data.sql` (if needed)
7. Run the SQL

---

## ğŸ¯ Step 3: Update Ashwheel App Configuration

### 3.1 Update .env.example

```env
# Production Supabase Configuration
VITE_SUPABASE_URL=https://supabase.ashwheel.cloud
VITE_SUPABASE_ANON_KEY=<YOUR_ANON_KEY_FROM_COOLIFY>
```

### 3.2 Commit Changes

```bash
git add .env.example
git commit -m "Update Supabase URL for production"
git push
```

---

## ğŸ¯ Step 4: Deploy Ashwheel App on Coolify

### 4.1 Create New Application

1. Click **"+ New Resource"**
2. Select **"Application"**
3. Choose **"Private Repository"**

### 4.2 Configure Application

**Repository Settings:**
- **Name:** ashwheel
- **Repository:** `https://github.com/Ashmzp/ashwheel.git`
- **Branch:** `main`
- **Build Pack:** Dockerfile

**Port Configuration:**
- **Port:** 80

**Domain Settings:**
- **Domain:** `ashwheel.cloud`
- **SSL:** Enable

### 4.3 Environment Variables

Add in Coolify UI:
```env
VITE_SUPABASE_URL=https://supabase.ashwheel.cloud
VITE_SUPABASE_ANON_KEY=<YOUR_ANON_KEY_FROM_COOLIFY>
```

### 4.4 Deploy

Click **"Deploy"** and wait 3-5 minutes.

---

## ğŸ¯ Step 5: DNS Configuration Summary

Add these A records in your domain registrar:

```
ashwheel.cloud           â†’  31.97.235.213
www.ashwheel.cloud       â†’  31.97.235.213
supabase.ashwheel.cloud  â†’  31.97.235.213
*.ashwheel.cloud         â†’  31.97.235.213
```

Wait 5-10 minutes for DNS propagation.

---

## âœ… Verification Steps

### 1. Check Supabase
```bash
curl https://supabase.ashwheel.cloud/rest/v1/
```
Should return API response.

### 2. Check Ashwheel App
```bash
curl https://ashwheel.cloud
```
Should return HTML.

### 3. Test Login
- Go to `https://ashwheel.cloud`
- Try to login
- Should connect to Supabase successfully

---

## ğŸ”§ Coolify Service Configuration (Alternative Method)

If Coolify doesn't have built-in Supabase, use Docker Compose:

### Create `docker-compose.supabase.yml` in Coolify:

```yaml
version: '3.8'

services:
  postgres:
    image: supabase/postgres:15.8.1.048
    environment:
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: postgres
    volumes:
      - postgres-data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD", "pg_isready", "-U", "postgres"]
      interval: 5s
      timeout: 5s
      retries: 10

  kong:
    image: kong:2.8.1
    environment:
      KONG_DATABASE: "off"
      KONG_DECLARATIVE_CONFIG: /var/lib/kong/kong.yml
      KONG_DNS_ORDER: LAST,A,CNAME
      KONG_PLUGINS: request-transformer,cors,key-auth,acl
    depends_on:
      - postgres
    ports:
      - "8000:8000"

  auth:
    image: supabase/gotrue:v2.174.0
    environment:
      GOTRUE_API_HOST: 0.0.0.0
      GOTRUE_API_PORT: 9999
      GOTRUE_DB_DRIVER: postgres
      GOTRUE_DB_DATABASE_URL: postgres://postgres:${POSTGRES_PASSWORD}@postgres:5432/postgres
      GOTRUE_SITE_URL: https://supabase.ashwheel.cloud
      GOTRUE_JWT_SECRET: ${JWT_SECRET}
    depends_on:
      - postgres

  rest:
    image: postgrest/postgrest:v12.2.12
    environment:
      PGRST_DB_URI: postgres://postgres:${POSTGRES_PASSWORD}@postgres:5432/postgres
      PGRST_DB_SCHEMAS: public,storage
      PGRST_DB_ANON_ROLE: anon
      PGRST_JWT_SECRET: ${JWT_SECRET}
    depends_on:
      - postgres

  studio:
    image: supabase/studio:latest
    environment:
      SUPABASE_URL: https://supabase.ashwheel.cloud
      STUDIO_PG_META_URL: http://meta:8080
      SUPABASE_ANON_KEY: ${ANON_KEY}
      SUPABASE_SERVICE_KEY: ${SERVICE_KEY}
    ports:
      - "3000:3000"

volumes:
  postgres-data:
```

---

## ğŸ“Š Final Architecture

```
31.97.235.213 (Coolify VPS)
â”‚
â”œâ”€ Caddy Proxy (Auto SSL)
â”‚  â”œâ”€ ashwheel.cloud â†’ Ashwheel App (Port 80)
â”‚  â””â”€ supabase.ashwheel.cloud â†’ Supabase Kong (Port 8000)
â”‚
â”œâ”€ Supabase Stack
â”‚  â”œâ”€ PostgreSQL (Database)
â”‚  â”œâ”€ Kong (API Gateway)
â”‚  â”œâ”€ GoTrue (Auth)
â”‚  â”œâ”€ PostgREST (API)
â”‚  â””â”€ Studio (Admin UI)
â”‚
â””â”€ Ashwheel App
   â”œâ”€ React Frontend
   â”œâ”€ Nginx Server
   â””â”€ Connects to Supabase API
```

---

## ğŸš€ Quick Start Commands

```bash
# 1. Update DNS
# Add A records for ashwheel.cloud and supabase.ashwheel.cloud

# 2. Deploy Supabase in Coolify UI
# Service â†’ Supabase â†’ Deploy

# 3. Note down Supabase credentials
# Copy ANON_KEY from Coolify

# 4. Update and push code
cd /mnt/c/Users/ASHISH/Desktop/ashwheel
# Update .env.example with new Supabase URL
git add .
git commit -m "Update Supabase URL for production"
git push

# 5. Deploy Ashwheel in Coolify UI
# Application â†’ GitHub â†’ Deploy

# 6. Test
curl https://ashwheel.cloud
curl https://supabase.ashwheel.cloud/rest/v1/
```

---

## ğŸ› ï¸ Troubleshooting

### Supabase Not Accessible?
```bash
# Check if service is running in Coolify
# Check logs in Coolify UI
# Verify DNS propagation: nslookup supabase.ashwheel.cloud
```

### App Can't Connect to Supabase?
```bash
# Verify VITE_SUPABASE_URL in Coolify environment variables
# Check CORS settings in Supabase
# Verify ANON_KEY is correct
```

### SSL Certificate Issues?
```bash
# Caddy auto-generates SSL
# Wait 2-3 minutes after deployment
# Check Coolify logs for SSL errors
```

---

## âœ… Success Checklist

- [ ] DNS configured (ashwheel.cloud â†’ 31.97.235.213)
- [ ] DNS configured (supabase.ashwheel.cloud â†’ 31.97.235.213)
- [ ] Supabase deployed in Coolify
- [ ] Database schema imported
- [ ] Supabase credentials noted
- [ ] .env.example updated with production URL
- [ ] Code pushed to GitHub
- [ ] Ashwheel app deployed in Coolify
- [ ] SSL working on both domains
- [ ] App successfully connects to Supabase
- [ ] Login/signup working

---

**ğŸ‰ Ready to Deploy! Follow steps in order.**
